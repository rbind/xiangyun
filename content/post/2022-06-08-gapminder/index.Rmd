---
date: "2022-06-08"
slug: gapminder
title: Gapminderï¼šå…³æ³¨å·®å¼‚ã€ç†è§£å˜åŒ–
categories:
  - ç»Ÿè®¡åº”ç”¨
tags:
  - R è¯­è¨€
  - ç»Ÿè®¡å›¾å½¢
  - gganimate
  - echarts4r
  - æŒ‡æ•° 
  - indicator
output:
  blogdown::html_page:
    toc: true
thumbnail: img/gganimate.svg
link-citations: true
mathjax: true
bibliography: 
  - packages.bib
description: "ä¸–ç•Œä¸Šæ²¡æœ‰ä¸¤ç‰‡ç›¸åŒçš„å¶å­ï¼Œå·®å¼‚æ˜¯å§‹ç»ˆå­˜åœ¨çš„ï¼Œç»Ÿè®¡ä¸Šçš„æ˜¾è‘—æ€§å·®å¼‚æ˜¯éœ€è¦ä»ä¸‡åƒå˜åŒ–ä¸­ç­›é€‰å‡ºæ¥çš„ã€‚ç›¸æ¯”äºç†è§£å˜åŒ–ï¼Œå…³æ³¨å·®å¼‚æ˜¯å®¹æ˜“çš„ã€‚"
---


```{css}
#| echo: false
.sidebar {
  border: 1px solid #ccc;
  border-left-width: 5px;
  border-radius: 5px;
  padding: 1em;
  margin: 1em 0;
}
.full-width {
  width: 100vw;
  margin-left: calc(50% - 50vw);
}

.full-width .caption {
  text-align: center;
}

figure {
  text-align: center;
}

div.img {
  text-align: center;
  display: block; 
  margin-left: auto; 
  margin-right: auto;
}
```


```{r}
#| label: setup
#| echo: false

knitr::opts_chunk$set(
  comment = "#",
  cache = FALSE,
  fig.align = "center",
  collapse = TRUE
)
```


::: sidebar
æœ¬æ–‡å¼•ç”¨çš„æ‰€æœ‰ä¿¡æ¯å‡ä¸ºå…¬å¼€ä¿¡æ¯ï¼Œä»…ä»£è¡¨ä½œè€…æœ¬äººè§‚ç‚¹ï¼Œä¸å°±èŒå•ä½æ— å…³ã€‚
:::


# é‡æ¸©ç»å…¸ {#ted-hans-rosling}

```{r}
#| echo: false
#| fig.align: "center"
#| label: ted-hans-rosling

knitr::include_url(url = "https://embed.ted.com/talks/lang/en/hans_rosling_the_best_stats_you_ve_ever_seen", height = "480px")
```


2005 å¹´ï¼ŒHans Roslingï¼ˆæ±‰æ–¯Â·ç½—ç³ï¼‰ å’Œå„¿å­ Ola Roslingã€å„¿åª³ Anna Rosling RÃ¶nnlund ä¸€èµ·åˆ›ç«‹äº†éè¥åˆ©æ€§æœºæ„ **Gapminder** (<https://www.gapminder.org/>)ï¼Œæ„¿æ™¯æ˜¯å»ºç«‹åŸºäºäº‹å®çš„ä¸–ç•Œè§‚ï¼Œç†è§£ä¸æ–­å˜åŒ–çš„ä¸–ç•Œï¼Œç½‘ç«™åå­— gap minder åŸæ„æ˜¯æé†’ä¹˜å®¢å°å¿ƒç«™å°å’Œåˆ—è½¦ä¹‹é—´çš„é—´éš™ï¼Œç¬”è€…è§‰å¾—æ„åœ¨æé†’å¤§å®¶å…³æ³¨å·®å¼‚ã€ç†è§£å˜åŒ–ã€‚2006 å¹´æ±‰æ–¯åœ¨ TED åšäº†ä¸€åœºæ¼”è®² --- [The best stats you've ever seen](https://www.ted.com/talks/hans_rosling_the_best_stats_you_ve_ever_seen?subtitle=zh-cn)ï¼ŒæœŸé—´å±•ç¤ºäº†ä¸€ç³»åˆ—ç”ŸåŠ¨å½¢è±¡çš„åŠ¨ç”»ï¼Œç”¨æ•°æ®å‘ˆç°çš„äº‹å®å¸®åŠ©å¤§å®¶è§£è¯»ä¸–ç•Œçš„å˜åŒ–ï¼Œå¯è°“æ˜¯åŠ¨æ€å›¾å½¢é¢†åŸŸçš„æƒŠä¸–ä¹‹ä½œã€‚æœ‰ä¸¤ä¸ªä»¤æˆ‘å°è±¡æ·±åˆ»çš„ç‚¹ï¼š

1. æ‰¾æœ€å…·ä»£è¡¨æ€§çš„æŒ‡æ ‡ï¼ŒæŠ“æœ€èƒ½å¼•èµ·è§‚ä¼—å…±é¸£çš„ç‚¹ï¼Œç”¨æ•°æ®ç”ŸåŠ¨æ´»æ³¼åœ°é˜è¿°ä¸€äº›å…ˆå…¥ä¸ºä¸»çš„åè§ï¼Œå¦‚å‘è¾¾å›½å®¶æ”¶å…¥é«˜ã€å¯¿å‘½é•¿ï¼Œå‘å±•ä¸­å›½å®¶æ”¶å…¥ä¸­ç­‰ã€å¯¿å‘½è¾ƒé•¿ï¼Œä¸å‘è¾¾å›½å®¶æ”¶å…¥ä½ã€å¯¿å‘½çŸ­ã€å©´å„¿æ­»äº¡ç‡é«˜ã€å®¶åº­æˆå‘˜å¤šç­‰ã€‚ä»ä¸»è§‚å°è±¡å‡ºå‘ï¼Œæ”¶é›†å°½å¯èƒ½å‡†ç¡®çš„æ•°æ®ï¼ŒåŒ…æ‹¬å¼€æ”¾ç»„ç»‡çš„æ•°æ®å’Œå®éªŒæ”¶é›†çš„æ•°æ®ã€‚ä»ä¸€äº›çœ‹ä¼¼ç®€å•å®åˆ™å¯Œå«ç»Ÿè®¡å’Œå› æœæ¨ç†çš„å®éªŒä¸­ï¼Œå‘ç°ä¸€ç³»åˆ—ååè§çš„ç»“è®ºã€‚

1. åœ¨é—®å·é‡Œï¼Œæˆå¯¹çš„ä¸¤ä¸ªå›½å®¶çš„å©´å„¿æ­»äº¡ç‡ä¹‹é—´è‡³å°‘æœ‰ä¸¤å€çš„å·®è·ï¼Œä»¥ç¡®ä¿æ•°æ®ä¹‹é—´çš„å·®è·è¿œå¤§äºæ•°æ®æœ¬èº«çš„è¯¯å·®ã€‚å°†é—®å·å¯¹è±¡ä»å­¦ç”Ÿæ‰©å±•åˆ°æ•™æˆï¼Œå†æ‹¿å¤§çŒ©çŒ©åšå¯¹ç…§ï¼Œæ•´ä¸ªå®éªŒæ—¢æœ‰ç”ŸåŠ¨æ€§åˆæœ‰æˆå‰§æ€§ï¼Œå¼ºçƒˆçš„åå·®ç»™è§‚ä¼—ç•™ä¸‹æ·±åˆ»çš„å°è±¡ï¼ŒçœŸæ˜¯ä¸€ä¸ªç²¾å½©çš„æ•°æ®æ•…äº‹ã€‚


![(\#fig:hans-rosling) æ±‰æ–¯ç”¨æ°”æ³¡å›¾æè¿°å„¿ç«¥å­˜æ´»ç‡ï¼ˆå¥åº·ï¼‰ä¸äººå‡ GDP ï¼ˆé‡‘é’±ï¼‰ çš„å…³ç³»](img/WorldHealth2001.pdf){ width=100% height=625px }


æ•°æ®å¯è§†åŒ–åœ¨æ•°æ®ç§‘å­¦ä¸­æ‰®æ¼”æ•°æ®æ¢ç´¢ã€å±•ç¤ºå’Œäº¤æµçš„é‡è¦è§’è‰²ï¼ŒåŠ¨æ€å›¾å½¢åŒ…å«çš„ä¿¡æ¯æ›´åŠ ä¸°å¯Œï¼Œåœ¨åˆé€‚çš„æ•°æ®é›†å’Œåº”ç”¨åœºæ™¯ä¸Šï¼Œè¯´ä¸å®šè¿˜èƒ½åƒæ±‰æ–¯é‚£æ ·æ”¶åˆ°å¥‡æ•ˆã€‚[ã€ŠåŠ¨ç”»åˆ¶ä½œä¸ Plotly Pythonã€‹](/2022/02/plotly-python-animations/) æ›¾ç”¨ [plotly](https://github.com/plotly/plotly.py) å°è¯•å¤ç°æ±‰æ–¯å±•ç¤ºçš„åŠ¨æ€æ°”æ³¡å›¾ï¼Œæè¿°æ•°æ®é—´çš„**å…³ç³»**å˜åŒ–ã€‚[ã€ŠR è¯­è¨€åˆ¶ä½œåœ°åŒºåˆ†å¸ƒå›¾åŠå…¶åŠ¨ç”»ã€‹](/2022/05/choropleth-map-animation)æ›¾åˆ†åˆ«ä½¿ç”¨ **gganimate** åŒ…å’Œ **echart4r** åŒ…æ¥åˆ¶ä½œå…³äº[åœ°åŒºåˆ†å¸ƒå›¾](https://en.wikipedia.org/wiki/Choropleth_map)çš„ GIF åŠ¨ç”»å’Œ Web åŠ¨ç”»ï¼Œç”¨åŠ¨ç”»æè¿°æ•°æ®çš„**ç©ºé—´**åˆ†å¸ƒå˜åŒ–ã€‚

<details>
<p><summary> ç‚¹å‡»æ˜¾ç¤ºæˆ–éšè—ä»£ç  </summary></p>
```{r}
#| ref.label: gapminder-echarts4r
#| eval: false
#| echo: true
```
</details>

```{r}
#| label: gapminder-echarts4r
#| echo: false
#| fig.cap: "ç”¨ echarts4r åŒ…å’Œ gapminder åŒ…å¤ç°æ±‰æ–¯Â·ç½—ç³çš„åŠ¨æ€æ°”æ³¡å›¾"
library(echarts4r)
# æä¾›æ•°æ®
data("gapminder", package = "gapminder")
# å¸¦å›½å®¶åç§°çš„é¢œè‰²å€¼å‘é‡ Named Vectors
data("country_colors", package = "gapminder")
# country_colors å‘½åå‘é‡è½¬åŒ–ä¸ºæ•°æ®æ¡†
country_colors_df <- stack(country_colors)
# é‡å‘½ååˆ—
colnames(country_colors_df) <- c("color", "country")
# æ¯ä¸ª country æŒ‡å®šé¢œè‰²å€¼
gapminder_df <- merge(
  x = gapminder, y = country_colors_df,
  by = "country", all.x = TRUE, sort = FALSE
)
# æ ‡é¢˜
titles <- lapply(unique(gapminder_df$year), function(x) {
  list(
    text = "Gapminder",
    left = "center"
  )
})
# èƒŒæ™¯å¹´ä»½æ•°å­—
years <- lapply(unique(gapminder_df$year), function(x) {
  list(
    subtext = x,
    left = "center",
    top = "center",
    z = 0,
    subtextStyle = list(
      fontSize = 100,
      color = "rgb(170, 170, 170, 0.5)",
      fontWeight = "bolder"
    )
  )
})

# æ ¹æ® continent åˆ—æ·»åŠ ä¸€åˆ—é¢œè‰²å€¼ï¼Œå„å¤§æ´²å’Œé¢œè‰²çš„å¯¹åº”å…³ç³»å¯è‡ªå®šä¹‰
# gapminder <- within(gapminder, {
#   color <- factor(
#     continent,
#     levels = c("Asia", "Africa", "Americas", "Europe", "Oceania"),
#     labels = RColorBrewer::brewer.pal(n = 5, name = "Spectral")
#   )
# })
# å›¾ä¸­æ‚¬æµ®æç¤ºä»…åŒ…å«å„å›½çš„é¢„æœŸå¯¿å‘½
# e_add_nested è®¾ç½®æ°”æ³¡çš„é¢œè‰²
gapminder_df |>
  group_by(year) |>
  e_charts(x = gdpPercap, timeline = TRUE) |>
  e_scatter(
    serie = lifeExp, size = pop, bind = country,
    symbol_size = 5, name = ""
  ) |>
  e_add_nested("itemStyle", color) |>
  e_y_axis(
    min = 20, max = 85, nameGap = 30,
    name = "Life Exp", nameLocation = "center"
  ) |>
  e_x_axis(
    type = "log", min = 100, max = 100000,
    nameGap = 30, name = "GDP / Cap", nameLocation = "center"
  ) |>
  e_timeline_serie(title = titles) |>
  e_timeline_serie(title = years, index = 2) |>
  e_timeline_opts(playInterval = 1000) |>
  e_grid(bottom = 100) |>
  e_tooltip()
```

ä¸Šå›¾\@ref(fig:gapminder-echarts4r)å’Œä¸‹å›¾\@ref(fig:gapminder-gganimate)åˆ†åˆ«æ˜¯é‡‡ç”¨ **echarts4r** å’Œ **gganimate** åŒ…[@gganimate]ç»˜åˆ¶çš„ï¼Œæ•°æ®æ¥è‡ª **gapminder** åŒ…[@gapminder]ï¼Œå°±åŠ¨ç”»åˆ¶ä½œæ¥è¯´ï¼Œåˆ°è¿™å°±å·®ä¸å¤šäº†ã€‚è€Œç¬”è€…ä¸€è´¯çš„é£æ ¼æ˜¯è¦ææ¸…æ¥šæ•°æ®æ¥é¾™å»è„‰ï¼Œç†è§£æ•…äº‹èƒŒåçš„æ•…äº‹ï¼Œ10 å¹´åï¼Œä¸€æ¬¡å¶ç„¶çš„æœºä¼šå†çœ‹æ±‰æ–¯Â·ç½—ç³çš„æ¼”è®²ï¼Œè¿™æ­£æ˜¯ä¸ªæ·±å…¥äº†è§£å¦‚ä½•åŠ¨æ€åœ°å¯è§†åŒ–æ•°æ®å…³ç³»å’Œæ•°æ®åˆ†å¸ƒçš„æœºä¼šã€‚

<details>
<p><summary> ç‚¹å‡»æ˜¾ç¤ºæˆ–éšè—ä»£ç  </summary></p>
```{r}
#| ref.label: gapminder-gganimate
#| eval: false
#| echo: true
```
</details>

```{r}
#| label: gapminder-gganimate
#| fig.cap: "é¢„æœŸå¯¿å‘½å’Œäººå‡ GDP çš„å…³ç³»ï¼šä»å¥åº·å’Œç»æµçš„å…³ç³»çœ‹å‘å±•ä¸­å›½å®¶å’Œå‘è¾¾å›½å®¶"
#| fig.align: "center"
#| dev: "ragg_png"
#| cache: true
#| echo: false

library(ggplot2)
library(gganimate)
ggplot(gapminder, aes(gdpPercap, lifeExp, size = pop, colour = country)) +
  geom_point(alpha = 0.7, show.legend = FALSE) +
  scale_color_manual(values = country_colors) +
  scale_size(range = c(2, 12)) +
  scale_x_log10(labels = scales::label_log()) +
  facet_wrap(~continent) +
  labs(title = "{frame_time} å¹´", x = "äººå‡ GDP", y = "é¢„æœŸå¯¿å‘½") +
  theme_minimal(base_family = "Noto Sans") +
  theme(title = element_text(family = "Noto Serif CJK SC")) +
  transition_time(year) +
  ease_aes("linear")
```


æœ¬æ–‡è¦æŠ›å¼€ä¸€äº›å·¥å…·å†…ç½®çš„ç©å…·æ•°æ®é›†ï¼Œæ— è®ºæ˜¯ R åŒ… **gapminder** è¿˜æ˜¯ Python æ¨¡å— **plotly**ï¼Œä»æ‰¾æ•°æ®å¼€å§‹ï¼Œè®¤çœŸç†è§£å’Œå¤ç°æ±‰æ–¯çš„åŠ¨ç”»ï¼Œåªæœ‰è¿™æ ·æ‰èƒ½æŒæ¡åº”ç”¨åŠ¨ç”»çš„ç²¾é«“ã€‚æ°”æ³¡å›¾ä½œä¸ºæ•£ç‚¹å›¾çš„å‡çº§ç‰ˆï¼ŒåŠ¨æ€æ°”æ³¡å›¾åˆæ˜¯æ°”æ³¡å›¾çš„è±ªåå‡çº§ç‰ˆï¼Œæè¿°æ•°é‡å…³ç³»åŠå…¶å˜åŒ–çš„æ ¸å¿ƒä½œç”¨æ²¡æœ‰å˜ã€‚é™¤äº†å¤ç°æ±‰æ–¯çš„åŠ¨æ€æ°”æ³¡å›¾ï¼Œè¿˜è¦æ ¹æ®æ•°æ®æƒ…å†µï¼Œé€‰æ‹©ä¸€äº›å…¶å®ƒå¯è§†åŒ–çš„æ–¹å¼ï¼Œæ¯”å¦‚ç”¨å¯†åº¦æ›²çº¿å›¾æè¿°æ•°æ®çš„åˆ†å¸ƒï¼Œç”¨å²­çº¿å›¾æè¿°åˆ†å¸ƒçš„å˜åŒ–ï¼Œè¿˜å¯ä»¥ç”¨åŠ¨æ€çš„å¯†åº¦æ›²çº¿å›¾å¤ç°æ±‰æ–¯çš„å¦ä¸€ä¸ªå…³äºä¸–ç•Œæ”¶å…¥åˆ†å¸ƒçš„åŠ¨ç”»ã€‚å› æ­¤ï¼Œæœ¬æ–‡æ¥ä¸‹æ¥åˆ†äº”ä¸ªéƒ¨åˆ†ä»‹ç»ï¼š

1.  è½¯ä»¶å‡†å¤‡ï¼šç®€è¦ä»‹ç»æœ¬æ–‡æ¶‰åŠçš„æ•°æ®è·å–ã€åˆ†æã€å¤„ç†å’Œå¯è§†åŒ–æ‰€éœ€è¦çš„ä¸€ç³»åˆ— R åŒ…ã€‚

1.  æ•°æ®å‡†å¤‡ï¼šè¯¦ç»†ä»‹ç»è·å–å’Œå¤„ç†æ•°æ®çš„è¿‡ç¨‹ã€‚

1.  æ•°æ®æ¢ç´¢ï¼šä»¥ 2001 å¹´çš„æ•°æ®ä¸ºä¾‹ï¼Œæ¢ç´¢å’Œå¤ç°æ±‰æ–¯Â·ç½—ç³çš„æ°”æ³¡å›¾å’Œå¯†åº¦åˆ†å¸ƒå›¾ã€‚

1.  æ•°æ®å±•ç¤ºï¼šåœ¨æ¢ç´¢çš„åŸºç¡€ä¸Šï¼Œå€ŸåŠ©å¤šç§å›¾å½¢å±•ç¤ºæ•°æ®é—´çš„å…³ç³»å’Œå˜åŒ–è¶‹åŠ¿ã€‚

1.  æœ¬æ–‡å°ç»“ï¼šä»æ•°æ®åˆ†æå’ŒæŠ€æœ¯å®ç°æ–¹é¢è°ˆä¸€ç‚¹æœ¬æ–‡å†™ä½œè¿‡ç¨‹ä¸­è·å–çš„ç»éªŒæ•™è®­ã€‚


# è½¯ä»¶å‡†å¤‡


å…ˆå®‰è£… [Noto å­—ä½“ç³»åˆ—](https://github.com/googlefonts/noto-cjk)çš„ä¸¤ä¸ªå­—ä½“åŒ…ï¼Œå³ç®€ä½“ä¸­æ–‡ç‰ˆçš„å®‹ä½“å­—å’Œæ— è¡¬çº¿çš„è‹±æ–‡å­—ä½“ã€‚åœ¨ Mac ç³»ç»Ÿä¸‹å®‰è£…èµ·æ¥éå¸¸ç®€å•ï¼Œä¸€è¡Œå‘½ä»¤å¦‚ä¸‹ï¼š

```{bash}
#| eval: false

brew install font-noto-serif-cjk-sc font-noto-sans
```

æ¥ç€ï¼Œè°ƒç”¨ **sysfonts** åŒ…[@sysfonts]åŠ è½½ä¸Šé¢å®‰è£…çš„ Noto ç³»åˆ—å­—ä½“ï¼ŒåŒ…æ‹¬ä¸­æ–‡å®‹ä½“å’Œè‹±æ–‡æ— è¡¬çº¿å­—ä½“ã€‚ç„¶åï¼Œ**showtext** åŒ…[@Qiu2015]å°±å¯ä»¥è°ƒç”¨ç³»ç»Ÿä¸­ã€è‹±æ–‡å­—ä½“å¤„ç†å›¾å½¢ä¸­çš„ä¸­ã€è‹±æ–‡å­—ç¬¦ã€‚

```{r}
## ç®€ä½“ä¸­æ–‡å®‹ä½“å­—
sysfonts::font_add(
  family = "Noto Serif CJK SC",
  regular = "NotoSerifCJKsc-Regular.otf",
  bold = "NotoSerifCJKsc-Bold.otf"
)
## æ— è¡¬çº¿è‹±æ–‡å­—ä½“
sysfonts::font_add(
  family = "Noto Sans",
  regular = "NotoSans-Regular.ttf",
  bold = "NotoSans-Bold.ttf",
  italic = "NotoSans-Italic.ttf",
  bolditalic = "NotoSans-BoldItalic.ttf"
)
```

å›  **showtext** åŒ…å°šä¸æ”¯æŒ **gganimate** åŒ…åˆ¶ä½œ**ä¸­æ–‡** GIF åŠ¨ç”»ï¼Œéœ€è¦ä½¿ç”¨ **ragg** åŒ…ï¼Œå®ƒæä¾›æ–°çš„å›¾å½¢è®¾å¤‡ï¼Œå¯ä»¥ç›´æ¥è°ƒç”¨ç³»ç»Ÿå®‰è£…çš„å­—ä½“ï¼Œåœ¨æœ¬æ–‡æºæ–‡æ¡£ä¸­ï¼Œå‡¡æ˜¯ä½¿ç”¨ **gganimate** çš„åœ°æ–¹ï¼Œæ·»åŠ ä»£ç å—é€‰é¡¹ `dev = 'ragg_png'` å³å¯ã€‚æ€»ä½“æ¥è¯´ï¼Œæœ¬æ–‡ä¸»è¦ä½¿ç”¨çš„ R åŒ…æœ‰ï¼š

1. **gapminder** åŒ…[@gapminder]ï¼š Jennifer Bryan æ‘˜å½•è‡ª [gapminder](https://www.gapminder.org/) ç½‘ç«™çš„æ•°æ®ï¼Œæ•°æ®ä¸æ›´æ–°ï¼Œä»…åšéƒ¨åˆ†æ¼”ç¤ºã€‚

1. **wbstats** åŒ…[@wbstats]ï¼šä»ä¸–ç•Œé“¶è¡Œæ•°æ®åº“è·å– 1960 - 2021 å¹´å„ä¸ªå›½å®¶çš„é¢„æœŸå¯¿å‘½ã€äººå‡ GDPå’Œäººå£æ€»æ•°æ•°æ®ã€‚

1. **showtext** åŒ…[@Qiu2015]ï¼šåŠ è½½ Noto ç³»åˆ—ä¸­è‹±æ–‡å­—ä½“ï¼Œä¾› **ggplot2** åŒ…ç»˜åˆ¶é™æ€å›¾å½¢ã€‚

1. **ragg** åŒ…[@ragg]ï¼šåŠ è½½ç³»ç»Ÿ Noto ç³»åˆ—ä¸­è‹±æ–‡å­—ä½“ï¼Œä¾› **gganimate** åŒ…ç»˜åˆ¶ GIF åŠ¨æ€å›¾å½¢ã€‚

1. **ggplot2** åŒ…[@Wickham2022]ï¼šå¤ç° 2001 å¹´æ±‰æ–¯Â·ç½—ç³åˆ¶ä½œçš„æ°”æ³¡å›¾\@ref(fig:hans-rosling)ç­‰ã€‚

1. **ggrepel** åŒ…[@ggrepel]ï¼šç¼“è§£ **ggplot2** åŒ…ç»˜åˆ¶çš„å›¾å½¢ä¸­æ–‡æœ¬é‡å é—®é¢˜ï¼Œç”¨äºå¤ç°å›¾\@ref(fig:hans-rosling)ã€‚

1. **ggridges** åŒ…[@ggridges]ï¼šç»˜åˆ¶å²­çº¿å›¾ï¼Œæ¯”å¦‚ 1960-2020 å¹´ä¸–ç•Œäººå‡ GDP åˆ†å¸ƒå˜åŒ–å›¾ã€‚

1. **gganimate** åŒ…[@gganimate]ï¼šäººå‡ GDP ä¸å¯¿å‘½å…³ç³»çš„æ°”æ³¡å›¾åŠ¨ç”»ï¼ˆGIF ç‰ˆï¼‰ã€‚

1. **echart4r** åŒ…[@echarts4r]ï¼šäººå‡ GDP ä¸å¯¿å‘½å…³ç³»çš„æ°”æ³¡å›¾åŠ¨ç”»ï¼ˆWeb ç‰ˆï¼‰ã€‚






# æ•°æ®å‡†å¤‡


R åŒ… **gapminder** å†…ç½®çš„æ•°æ®é›†**æ‘˜å½•**è‡ªç½‘ç«™ <https://www.gapminder.org/>ï¼ŒåŒ…å« 1952-2007 å¹´142 ä¸ªå›½å®¶çš„é¢„æœŸå¯¿å‘½ã€æ€»äººå£ã€äººå‡ GDP æ•°æ®ï¼Œæ‘˜å½•é—´éš”æ˜¯ 5 å¹´ï¼Œç”¨äº **gganimate** åŒ…çš„å¸®åŠ©æ–‡æ¡£ï¼Œä»‹ç»åŠ¨ç”»åˆ¶ä½œè¿‡ç¨‹ï¼Œä¹ƒè‡³æ•™å­¦åŸ¹è®­ï¼Œéƒ½æ˜¯éå¸¸åˆé€‚çš„ã€‚
**gapminder** åŒ…å¼€å‘è€… Jennifer Bryan æ˜ç¡®å‘Šè¯‰å¤§å®¶å¥¹ä¸ä¼šæ›´æ–°æ•°æ®é›†ï¼Œæ›´ä¸é€‚åˆä½œä¸ºç¤¾ä¼šç»æµæ•°æ®æ¥åšåˆ†æã€‚ç¬”è€…ç‰¹åˆ«ä¸å–œæ¬¢åˆ†æç¬¬ä¸‰æ‰‹çš„æ•°æ®ï¼Œç»è¿‡ä¸€ç•ªæŸ¥æ‰¾ï¼Œå‘ç°ä¸–ç•Œé“¶è¡Œæä¾›ç›¸å…³æ•°æ®ï¼Œä¸” **wbstats** åŒ…æä¾›å‡½æ•° `wb_indicators()` å¯ä»¥æŸ¥è¯¢å¼€æ”¾çš„æ•°æ®æŒ‡æ ‡ï¼Œç›®å‰æœ‰ **19246** ä¸ªï¼Œä¹Ÿæä¾›å‡½æ•° `wb_data()` è·å–å„ä¸ªå¹´ä»½æ•°æ®ã€‚ä¸‹é¢è·å–å„ä¸ªå›½å®¶è‡ª 1960 å¹´è‡³ä»Šçš„ä¸€äº›å®è§‚ç»æµæŒ‡æ ‡ï¼Œæ¯”å¦‚æ–°é—»é‡Œå¸¸è§çš„äººå£æ€»æ•°ã€äººå‡ GDPã€é¢„æœŸå¯¿å‘½ã€Gini æŒ‡æ•°ã€æ¶ˆè´¹ä»·æ ¼æŒ‡æ•°ã€é€šè´§è†¨èƒ€ç‡ç­‰ã€‚


```{r}
#| eval: false
#| echo: true

# ä»ä¸–ç•Œé“¶è¡Œæ•°æ®åº“è·å–å®è§‚ç»æµæ•°æ®
wb_world_indicator <- wbstats::wb_data(
  indicator = c(
    "SL.UEM.TOTL", # å¤±ä¸šäººæ•° Number of people unemployed
    "SL.UEM.TOTL.ZS", # å¤±ä¸šç‡ Unemployed (%) (modeled ILO estimate)
    "SL.UEM.TOTL.NE.ZS", # å¤±ä¸šç‡ Unemployed (%) national estimate

    "NY.GDP.PCAP.KD.ZG", # äººå‡ GDP å¢é€Ÿ
    "NY.GDP.MKTP.CD", # GDP æ€»é‡
    "NY.GDP.MKTP.KD.ZG", # GDP å¢é€Ÿ

    "FP.CPI.TOTL", # æ¶ˆè´¹ä»·æ ¼æŒ‡æ•°ï¼ˆä»¥ 2010 å¹´ä¸ºå¯¹æ¯”åŸºæ•° 100ï¼‰
    "FP.CPI.TOTL.ZG", # é€šè´§è†¨èƒ€ç‡
    "SI.POV.GINI", # Gini æŒ‡æ•°

    "SP.DYN.LE00.IN", # é¢„æœŸå¯¿å‘½
    "NY.GDP.PCAP.CD", # äººå‡ GDP
    "SP.POP.TOTL" # äººå£æ€»æ•°
  ),
  country = "countries_only",
  return_wide = FALSE,
  start_date = 1960, end_date = 2021
)
# ä¿å­˜æ•°æ®åˆ°æœ¬åœ°ï¼Œæ–¹ä¾¿åç»­ä½¿ç”¨
saveRDS(wb_world_indicator, file = "wb_world_indicator.rds")
```
```{r}
#| echo: false

wb_world_indicator <- readRDS(file = "data/wb_world_indicator.rds")
```

å…ˆçœ‹ä¸‹è·å–çš„æ•°æ®æƒ…å†µï¼š

```{r}
str(wb_world_indicator)
head(wb_world_indicator)
```

æ¥ç€è·å–å„ä¸ªå›½å®¶çš„å…ƒæ•°æ®ä¿¡æ¯ï¼Œä¹ŸæŸ¥çœ‹æ•°æ®æƒ…å†µã€‚

```{r}
#| cache: true

wb_countries_info <- wbstats::wb_countries()
str(wb_countries_info)
```

æ•°æ®é›† wb_countries_info å†…å®¹æœ‰å¾ˆå¤šï¼Œæœ¬æ–‡åªéœ€è¦å›½å®¶çš„åœ°åŸŸåˆ†ç±»ä¿¡æ¯ï¼Œå³ iso3c å’Œ region ä¸¤ä¸ªå­—æ®µã€‚

```{r}
wb_countries_info_sub <- subset(x = wb_countries_info, select = c("iso3c", "region", "income_level"))
```

æ¥ç€ï¼Œä»¥å·¦å…³è”çš„æ–¹å¼å°†åŒºåŸŸä¿¡æ¯åˆå¹¶åˆ°å®è§‚ç»æµæ•°æ®ä¸Šã€‚

```{r}
wb_world_indicator <- merge(x = wb_world_indicator, y = wb_countries_info_sub, by = "iso3c", all.x = TRUE, sort = FALSE)
```

åˆå¹¶åï¼Œå†æŸ¥çœ‹æ•°æ®çš„æƒ…å†µã€‚

```{r}
str(wb_world_indicator)
head(wb_world_indicator)
```

æ¥ç€ï¼Œç­›é€‰ 2001 å¹´çš„æ•°æ®ï¼ŒæŒ‘é€‰å¤ç°æ°”æ³¡å›¾æ‰€éœ€çš„ä¸‰ä¸ªæ•°æ®æŒ‡æ ‡ï¼šäººå‡ GDPã€é¢„æœŸå¯¿å‘½å’Œäººå£æ€»æ•°ã€‚

```{r}
wb_hans_2001 <- subset(
  x = wb_world_indicator,
  subset = date == 2001 & indicator_id %in% c("SP.DYN.LE00.IN", "NY.GDP.PCAP.CD", "SP.POP.TOTL"),
  select = c("date", "country", "region", "income_level", "value", "indicator_id")
)
```

æ¥ç€ï¼Œç»§ç»­æŸ¥çœ‹å­é›†æ•°æ®ã€‚

```{r}
head(wb_hans_2001)
```


ç„¶åï¼Œå°†æ­¤ã€Œé•¿æ ¼å¼ã€çš„æ•°æ®è½¬ä¸ºã€Œå®½æ ¼å¼ã€çš„æ•°æ®ã€‚

```{r}
wb_hans_2001 <- reshape(
  data = wb_hans_2001,
  varying = c("SP.POP.TOTL", "SP.DYN.LE00.IN", "NY.GDP.PCAP.CD"),
  timevar = "indicator_id",
  idvar = c("date", "country", "region", "income_level"),
  direction = "wide"
)
```

æŸ¥çœ‹è½¬åŒ–åçš„æ•°æ®ã€‚

```{r}
head(wb_hans_2001)
```

ç¡®è®¤æ•°æ®æ“ä½œçš„è¿‡ç¨‹æ²¡æœ‰é—®é¢˜åï¼Œä¸‹é¢å¼€å§‹æ¢ç´¢æ•°æ®ã€‚


# æ•°æ®æ¢ç´¢


## 2001 å¹´é¢„æœŸå¯¿å‘½ä¸äººå‡ GDP çš„å…³ç³»


æ±‰æ–¯Â·ç½—ç³ç”¨æ°”æ³¡å›¾ \@ref(fig:hans-bubble) æè¿°é¢„æœŸå¯¿å‘½å’Œäººå‡ GDP çš„å…³ç³»ï¼Œæœ¬æ–‡ç”¨ R åŒ… **ggplot2** å’Œ **ggrepel** [@ggrepel] æ¥å®ç°ç±»ä¼¼çš„æ•ˆæœã€‚

1. åœ¨æ•£ç‚¹å›¾å±‚ `geom_point()` ä¸­ï¼Œäººå£æ€»æ•°æ˜ å°„ç‚¹çš„**é¢ç§¯å¤§å°** `size`ï¼Œ ä¸–ç•Œå„å›½æ‰€åœ¨åŒºåŸŸæ˜ å°„é¢œè‰² `color`ï¼Œè¿™å°±å®ç°äº†ä¸€ä¸ªå¸¦åˆ†ç»„çš„æ°”æ³¡å›¾ï¼Œè®¾ç½®ä¸€å®šçš„é€æ˜åº¦ï¼Œç¨ç¼“è§£æ°”æ³¡é‡å é—®é¢˜ã€‚

1. è€ƒè™‘åˆ°æ–‡æœ¬é‡å é—®é¢˜ï¼Œæ²¡æœ‰ä½¿ç”¨ **ggplot2** å†…ç½®çš„æ–‡æœ¬å›¾å±‚ `geom_text()`ï¼Œè€Œæ˜¯è°ƒç”¨ **ggrepel** åŒ…æä¾›çš„æ–‡æœ¬å›¾å±‚ `geom_text_repel()`ï¼Œäººå£æ€»æ•°æ˜ å°„æ–‡æœ¬å¤§å° `size`ï¼Œå›½å®¶åç§°æ˜ å°„æ–‡æœ¬æ ‡ç­¾ `label`ã€‚å›¾ä¸­äººå£å¤§äº 2000 ä¸‡çš„å›½å®¶ï¼Œäººå£è¶Šå¤šå›½å®¶åç§°è¶Šå¤§ï¼Œå°äº 2000 ä¸‡çš„å­—ä½“å¤§å°å–å›ºå®šçš„å€¼ã€‚

1. é™¤äº† 1 å’Œ 2ï¼Œå‰©ä½™çš„éƒ½ç®—æ˜¯ç»†èŠ‚è°ƒæ•´äº†ã€‚æ¨ªè½´é‡‡ç”¨ä»¥ 10 ä¸ºåº•çš„å¯¹æ•°å°ºåº¦ï¼Œä¸»åˆ»åº¦æ ‡ç­¾å¸¦ç¾å…ƒç¬¦å·ï¼Œè®¾ç½®åˆ»åº¦æ•°é‡ï¼Œæ·»åŠ æ¬¡åˆ»åº¦çº¿ã€‚çºµè½´è®¾ç½®æ›´å¤šçš„åˆ»åº¦ï¼Œç›¸åº”å¢åŠ èƒŒæ™¯å‚è€ƒçº¿ã€‚

1. é€‰ä¸€ä¸ªçœ‹ç€åˆé€‚çš„åˆ†ç±»å‹è°ƒè‰²æ¿ï¼Œå›¾ä¸­é‡‡ç”¨ **RColorBrewer** åŒ…[@RColorBrewer] æä¾›çš„ Set1 è°ƒè‰²æ¿ã€‚

1. æ§åˆ¶æ°”æ³¡å¤§å°èŒƒå›´å’Œå±‚æ¬¡ï¼Œè®¾ç½®å…¨å±€æç®€ä¸»é¢˜é£æ ¼ã€‚

1. å›¾ä¾‹æ”¾åœ¨å›¾å½¢åŒºåŸŸå³ä¸‹è§’ï¼Œå–æ¶ˆæ–‡æœ¬å›¾å±‚çš„å›¾ä¾‹ï¼Œæ•´ä½“ä¸Šï¼Œå›¾å½¢å°±åè°ƒäº†ï¼Œå¢¨è‰²æ¯”ä¹Ÿä¸Šå»äº†ã€‚è®¾ç½®åæ ‡è½´æ ‡é¢˜ã€å›¾ä¾‹æ ‡é¢˜åŠå…¶å­—ä½“ã€‚

<details>
<p><summary> ç‚¹å‡»æ˜¾ç¤ºæˆ–éšè—ä»£ç  </summary></p>
```{r}
#| ref.label: hans-bubble
#| eval: false
#| echo: true
```
</details>

::: {.full-width}
```{r}
#| label: hans-bubble
#| fig.cap: "2001 å¹´å¯¿å‘½å’Œäººå‡ GDP çš„å…³ç³»"
#| fig.showtext: true
#| fig.align: "center"
#| echo: false
#| fig.width: 10
#| fig.height: 8

library(ggplot2)
library(ggrepel)
mb <- unique(as.numeric(1:10 %o% 10^(1:4)))
ggplot(
  data = wb_hans_2001,
  aes(x = NY.GDP.PCAP.CD, y = SP.DYN.LE00.IN)
) +
  geom_point(aes(size = SP.POP.TOTL / 10^6, color = region), alpha = 0.7, na.rm = TRUE) +
  geom_text_repel(
    data = wb_hans_2001[wb_hans_2001$SP.POP.TOTL < 2 * 10^7, ],
    aes(label = country),
    max.overlaps = 50, size = 2.25,
    segment.colour = "gray", seed = 2022,
    show.legend = FALSE, na.rm = TRUE
  ) +
  geom_text_repel(
    data = wb_hans_2001[wb_hans_2001$SP.POP.TOTL >= 2 * 10^7, ],
    aes(size = SP.POP.TOTL / (5 * 10^7), label = country),
    max.overlaps = 50,
    segment.colour = "gray", seed = 2021,
    show.legend = FALSE, na.rm = TRUE
  ) +
  scale_color_brewer(palette = "Set1") +
  scale_x_log10(labels = scales::label_dollar(), n.breaks = 6, minor_breaks = mb) +
  scale_y_continuous(n.breaks = 10) +
  scale_size(breaks = c(1, 10, 100, 1000), range = c(1, 20)) +
  labs(
    x = "äººå‡ GDP", y = "é¢„æœŸå¯¿å‘½",
    size = "äººå£ï¼ˆç™¾ä¸‡ï¼‰", color = "åŒºåŸŸ"
  ) +
  theme_minimal(base_family = "Noto Sans", base_size = 13) +
  theme(
    title = element_text(family = "Noto Serif CJK SC"),
    legend.position = c(0.88, 0.35)
  )
```
:::

å¦‚å›¾æ‰€ç¤ºï¼Œæ’’å“ˆæ‹‰ä»¥å—çš„éæ´²åœ°åŒºäººå‡ GDP ä½ã€é¢„æœŸå¯¿å‘½çŸ­ï¼Œå—äºšç¨é«˜ä¸€äº›ï¼Œä¸œäºšåŠå¤ªå¹³æ´‹ã€æ¬§æ´²åŠä¸­äºšåœ°åŒºäººå‡ GDP å’Œé¢„æœŸå¯¿å‘½è·¨åº¦å¤§ï¼Œæ¯”å¦‚æ—¥æœ¬ã€æ–°åŠ å¡ã€é¦™æ¸¯ã€æ¾³é—¨ç­‰åœ°åŒºæ­¥å…¥å‘è¾¾å›½å®¶çš„æ°´å¹³ï¼Œä¸­ä¸œåŠåŒ—éåœ°åŒºäººå‡ GDP è·¨åº¦ä¹Ÿä¸å°ã€‚åŒ—ç¾éƒ½æ˜¯å‘è¾¾å›½å®¶ï¼Œæ‹‰ç¾é›†ä¸­åœ¨ä¸­ç­‰æ”¶å…¥æ°´å¹³ã€‚ä¸–ç•Œé“¶è¡Œè¿˜æä¾›äº†å›½å®¶æ”¶å…¥æ°´å¹³çš„åˆ’åˆ†ï¼Œå¦‚å›¾\@ref(fig:hans-income-bubble)æ‰€ç¤ºï¼Œä»¥åˆ†é¢çš„å½¢å¼å¯ä»¥æ›´åŠ æ¸…æ¥šåœ°å±•ç¤ºå„ä¸ªåœ°åŒºçš„é¢„æœŸå¯¿å‘½å’Œäººå‡ GDP çš„å…³ç³»ã€‚

::: {.full-width}
```{r}
#| label: hans-income-bubble
#| fig.cap: "2001 å¹´å¯¿å‘½å’Œäººå‡ GDP çš„å…³ç³»ï¼ˆåˆ†åœ°åŒºï¼‰"
#| fig.showtext: true
#| fig.align: "center"
#| echo: false
#| fig.width: 12
#| fig.height: 9

wb_hans_2001$income_level <- factor(
  wb_hans_2001$income_level,
  labels = c("Low income", "Lower middle income", "Upper middle income", "High income", "Not classified"),
  levels = c("Low income", "Lower middle income", "Upper middle income", "High income", "Not classified")
)
ggplot(
  data = wb_hans_2001,
  aes(x = NY.GDP.PCAP.CD, y = SP.DYN.LE00.IN)
) +
  geom_point(aes(size = SP.POP.TOTL / 10^6, color = income_level), alpha = 0.7, na.rm = TRUE) +
  scale_x_log10(labels = scales::label_log()) +
  scale_color_brewer(palette = "Set1") +
  scale_size(breaks = c(1, 10, 100, 1000), range = c(1, 20)) +
  facet_wrap(~region, ncol = 4) +
  labs(
    x = "äººå‡ GDP", y = "é¢„æœŸå¯¿å‘½",
    size = "äººå£ï¼ˆç™¾ä¸‡ï¼‰", color = "æ”¶å…¥æ°´å¹³"
  ) +
  theme_minimal(base_family = "Noto Sans", base_size = 13) +
  theme(
    title = element_text(family = "Noto Serif CJK SC"),
    legend.position = "bottom", legend.box = "vertical",
    legend.margin = margin()
  )
```
:::


<details>
<p><summary> ç‚¹å‡»æ˜¾ç¤ºæˆ–éšè—ä»£ç  </summary></p>
```{r}
#| ref.label: hans-income-bubble
#| eval: false
#| echo: true
```
</details>


## 2001 å¹´ä¸–ç•Œå„åœ°åŒºäººå‡ GDP åˆ†å¸ƒå›¾

GDP å’Œäººå‡ GDP æŒ‡æ ‡æ˜¯å®˜åª’å®£ä¼ æœ€å¤šçš„ï¼Œå„å›½å¸Œæœ›è¥é€ ä¸€ä¸ªæ©„æ¦„çƒçŠ¶çš„æ”¶å…¥ç»“æ„ã€‚åœ¨ä¸Šä¸€èŠ‚å¯ä»¥ç²—ç•¥çœ‹å‡ºäººå‡ GDP å°†å„ä¸ªå›½å®¶åˆ’åˆ†ä¸ºæ”¶å…¥ä¸åŒçš„ç¾¤ä½“ï¼Œä¸‹é¢é‡‡ç”¨å¯†åº¦ä¼°è®¡å›¾å±•ç¤ºå…¨ä¸–ç•Œæ”¶å…¥çš„åˆ†å¸ƒã€‚å¦‚å›¾\@ref(fig:hans-density)æ‰€ç¤ºï¼Œæ¨ªè½´è¡¨ç¤ºäººå‡ GDPï¼Œçºµè½´è¡¨ç¤ºå›½å®¶æ•°é‡ï¼Œä¸åŒåŒºåŸŸçš„äººå‡ GDP çš„åˆ†å¸ƒï¼Œä¸–ç•Œæ€»çš„äººå‡ GDP çš„åˆ†å¸ƒéƒ½å±•ç¤ºå‡ºæ¥äº†ï¼Œå›½å®¶å±‚é¢ï¼Œæ”¶å…¥é˜¶å±‚çš„åˆ’åˆ†éå¸¸æ¸…æ™°ã€‚æ’’å“ˆæ‹‰ä»¥å—çš„å›½å®¶æˆ–åœ°åŒºé›†ä¸­åœ¨äººå‡ 500 ç¾å…ƒå·¦å³çš„åŒºé—´é‡Œï¼Œå°‘é‡è¾¾åˆ° 5000 ç¾å…ƒçš„ï¼Œæå°‘é‡è¾¾åˆ° 10000 ç¾å…ƒçš„ã€‚

<details>
<p><summary> ç‚¹å‡»æ˜¾ç¤ºæˆ–éšè—ä»£ç  </summary></p>
```{r}
#| ref.label: hans-density
#| eval: false
#| echo: true
```
</details>


```{r}
#| label: hans-density
#| fig.cap: "2002 å¹´ä¸–ç•Œäººå‡ GDP çš„åˆ†å¸ƒ"
#| fig.showtext: true
#| fig.align: "center"
#| echo: false
#| cache: true
#| fig.width: 10
#| fig.height: 6

mb <- unique(as.numeric(1:10 %o% 10^(1:4)))
ggplot(
  data = wb_hans_2001,
  aes(x = NY.GDP.PCAP.CD, y = stat(density * n), fill = region)
) +
  geom_density(position = "stack", colour = "white", na.rm = TRUE, alpha = 0.7) +
  scale_fill_brewer(palette = "Set1") +
  scale_x_log10(
    labels = scales::label_dollar(),
    limits = c(50, 300000),
    minor_breaks = mb
  ) +
  labs(
    x = "äººå‡ GDP", y = "å›½å®¶æ•°é‡", fill = "åŒºåŸŸ"
  ) +
  theme_minimal(base_family = "Noto Sans", base_size = 13) +
  theme(
    title = element_text(family = "Noto Serif CJK SC"),
    legend.position = "bottom"
  )
```


ç›¸ä¿¡å¤§å®¶å¯¹ã€ŒäºŒå…«å®šå¾‹ã€ä¸é™Œç”Ÿï¼Œç®€å•è®²å°±æ˜¯ 20% çš„äººå£å æœ‰å…¨ä¸–ç•Œ 80% çš„è´¢å¯Œï¼Œåœ¨ç»æµç¤¾ä¼šç­‰é¢†åŸŸå¹¿æ³›å­˜åœ¨ã€‚ä¸‹é¢æ ¹æ®ä¸–ç•Œé“¶è¡Œçš„æ•°æ®ï¼Œç®€å•ç»Ÿè®¡ä¸€ä¸‹ï¼š

```{r}
aggregate(wb_hans_2001, cbind(NY.GDP.PCAP.CD, SP.POP.TOTL) ~ income_level, sum, na.rm = TRUE)
```

è´«ç©·çš„ä½æ”¶å…¥å›½å®¶å’Œä¸­ä½æ”¶å…¥å›½å®¶å æœ‰ä¸–ç•Œçš„è´¢å¯Œæ¯”ä¾‹ä¸º 3.619% è€Œäººå£å æ¯”ä¸º 46.27%ã€‚å³è¿‘ä¸€åŠçš„äººå£å æœ‰çš„è´¢å¯Œä¸è¶³ 4%ã€‚è€Œé«˜æ”¶å…¥å›½å®¶å æœ‰çš„è´¢å¯Œæ¯”ä¾‹ä¸º 87.6%ï¼Œç›¸åº”çš„äººå£å æ¯”ä¸º 17.34%ï¼Œå³ä¸éœ€è¦ 20% çš„äººå£å°±è¿œè¿œå æ®äº† 80% çš„è´¢å¯Œï¼Œæ¯”äºŒå…«æ›´ç‹ ï¼


# æ•°æ®å±•ç¤º

å…ˆå‡†å¤‡å„ä¸ªå¹´ä»½çš„å†å²æ•°æ®ï¼Œä»ä¹‹å‰è·å–çš„å¤§æ•°æ®é›†ä¸­ wb_world_indicator æŠ½å–ä¸€éƒ¨åˆ†ï¼š

```{r}
wb_hans <- subset(
  x = wb_world_indicator,
  subset = indicator_id %in% c("SP.DYN.LE00.IN", "NY.GDP.PCAP.CD", "SP.POP.TOTL"),
  select = c("date", "country", "region", "value", "indicator_id")
)
```

å°†ã€Œé•¿æ ¼å¼ã€çš„æ•°æ®é‡å¡‘æˆã€Œå®½æ ¼å¼ã€çš„æ•°æ®ï¼š

```{r}
wb_hans <- reshape(
  data = wb_hans,
  varying = c("SP.POP.TOTL", "NY.GDP.PCAP.CD", "SP.DYN.LE00.IN"),
  timevar = "indicator_id",
  idvar = c("date", "country", "region"),
  direction = "wide"
)
wb_hans <- wb_hans[order(wb_hans$date), ]
```

æŸ¥çœ‹å˜å½¢é‡å¡‘åçš„æ•°æ®æ ·å­ï¼š

```{r}
head(wb_hans)
```


## ä¸–ç•Œå„åœ°åŒºäººå‡ GDP åˆ†å¸ƒå›¾


æ±‰æ–¯åœ¨ TED æ¼”è®²ä¸­è¿˜å±•ç¤ºäº†å¦ä¸€å¹…ä¸–ç•Œå„å›½äººå‡ GDP çš„åˆ†å¸ƒåŠ¨ç”»ï¼Œæ•ˆæœç±»ä¼¼ä¸‹å›¾\@ref(fig:wb-hans-density)ã€‚ç«™åœ¨ **ggplot2** å’Œ **gganimate** çš„è‚©è†€ä¸Šï¼Œæœ‰äº†å‰é¢çš„ç»éªŒï¼Œåˆ¶ä½œèµ·æ¥ä¸éš¾ï¼Œæ„Ÿå…´è¶£çš„è¯»è€…å¯æŸ¥çœ‹ä»£ç å¤ç°ã€‚

<details>
<p><summary> ç‚¹å‡»æ˜¾ç¤ºæˆ–éšè—ä»£ç  </summary></p>
```{r}
#| ref.label: wb-hans-density
#| eval: false
#| echo: true
```
</details>


```{r}
#| label: wb-hans-density
#| fig.cap: "ä¸–ç•Œå„åœ°åŒºäººå‡ GDP åˆ†å¸ƒå›¾"
#| dev: "ragg_png"
#| fig.align: "center"
#| cache: true
#| echo: false
#| fig.width: 10
#| fig.height: 6

library(gganimate)
mb <- unique(as.numeric(1:10 %o% 10^(1:4)))
ggplot(
  data = wb_hans,
  aes(x = NY.GDP.PCAP.CD, y = stat(density * n), fill = region)
) +
  geom_density(
    position = "stack", colour = "white",
    na.rm = TRUE, alpha = 0.7
  ) +
  scale_fill_brewer(palette = "Set1") +
  scale_x_log10(
    labels = scales::label_dollar(),
    limits = c(10, 350000),
    minor_breaks = mb
  ) +
  labs(
    title = "{frame_time} å¹´", fill = "åŒºåŸŸ",
    x = "äººå‡ GDP", y = "å›½å®¶æ•°é‡"
  ) +
  theme_minimal(base_family = "Noto Sans", base_size = 13) +
  theme(
    title = element_text(family = "Noto Serif CJK SC"),
    legend.position = "bottom"
  ) +
  transition_time(date)
```

æœ‰ç‚¹ä½©æœæ±‰æ–¯çš„æƒ³è±¡åŠ›ï¼Œä»–æŠŠå¤šå³°çŠ¶æ€ä¸‹çš„åˆ†å¸ƒå›¾çœ‹ä½œæ˜¯ğŸ‘»åœ¨æ‘†æ‰‹ï¼Œä¸­ä½æ”¶å…¥å›½å®¶å½¢æˆçš„ä¸¤åº§å±±å³°æ­£åƒğŸ‘»ä¸€æ ·æ­¥æ­¥é€¼è¿‘æ¬§ç¾ç­‰å‘è¾¾å›½å®¶ï¼Œæœ€ç»ˆï¼Œå¤šå³°å‡ ä¹å˜æˆäº†å•å³°ã€‚

ç¬”è€…æ­¤æ¬¡ä»ä¸–ç•Œé“¶è¡Œæ”¶é›†äº† 1960 å¹´è‡³ä»Šçš„å†å²æ•°æ®ï¼Œåœ¨å›¾\@ref(fig:hans-density) çš„åŸºç¡€ä¸Šï¼Œä¸‹é¢æ‹‰é•¿æ—¶é—´è·¨åº¦ï¼Œä»¥å²­çº¿å›¾è§‚æµ‹è¿‡å» 60 å¹´ä¸–ç•Œæ”¶å…¥çš„å˜åŒ–ã€‚äºŒæˆ˜ä»¥åï¼Œæ•´ä½“ä¸Šï¼Œä¸–ç•Œä»¥å’Œå¹³ä¸å‘å±•ä¸ºä¸»é¢˜ï¼Œä½ å¥½æˆ‘å¥½å¤§å®¶å¥½ï¼Œä¸€èµ·æŠŠäººå‡ GDP æä¸Šå»ï¼Œå¯¹æ•°åŒ–äººå‡ GDP æ•°æ®åï¼Œå…¶åˆ†å¸ƒæ­£æœç€æ­£æ€å‹æ›²çº¿çš„æ–¹å‘è¿ˆè¿›ã€‚ç‰¹åˆ«åœ°ï¼Œ2001 å¹´å…¨çƒåŒ–åŠ é€Ÿï¼Œé«˜æ”¶å…¥å’Œä¸­é«˜æ”¶å…¥å›½å®¶ä¹‹é—´çš„å¤§å³¡è°·æ­£åœ¨é€æ¸æ¶ˆå¤±ï¼Œå¾ˆå¤šä¸­ä½æ”¶å…¥å›½å®¶çš„äººå‡ GDP è¿ˆè¿›äº† 10000 ç¾å…ƒçš„å¤§é—¨ï¼Œç»ˆäºæˆäº†ä¸‡å…ƒæˆ·ï¼Œä¸è¿‡è·ç¦»ä»¥ç¾å›½ä¸ºä»£è¡¨çš„å‘è¾¾å›½å®¶ä»ç„¶æœ‰ 8-10 å€çš„å·®è·ã€‚


<details>
<p><summary> ç‚¹å‡»æ˜¾ç¤ºæˆ–éšè—ä»£ç  </summary></p>
```{r}
#| ref.label: hans-density-ridges
#| eval: false
#| echo: true
```
</details>

```{r}
#| label: hans-density-ridges
#| fig.cap: "ä¸–ç•Œäººå‡ GDP åˆ†å¸ƒå›¾"
#| fig.showtext: true
#| fig.align: "center"
#| echo: false
#| fig.width: 9
#| fig.height: 7
#| message: false

library(ggridges)
mb <- unique(as.numeric(1:10 %o% 10^(1:4)))
ggplot(
  data = wb_hans, aes(x = NY.GDP.PCAP.CD, y = date, group = date)
) +
  geom_density_ridges(scale = 10, size = 0.25, rel_min_height = 0.03, na.rm = TRUE) +
  scale_x_log10(
    labels = scales::label_dollar(), n.breaks = 6,
    minor_breaks = mb
  ) +
  scale_y_reverse(n.breaks = 10) +
  labs(
    x = "äººå‡ GDP", y = "å¹´ä»½"
  ) +
  theme_minimal(base_family = "Noto Sans", base_size = 13) +
  theme(
    title = element_text(family = "Noto Serif CJK SC"),
    axis.ticks = element_line(size = 0.5)
  )
```


## é¢„æœŸå¯¿å‘½ä¸äººå‡ GDP çš„å…³ç³»


GIF åŠ¨å›¾çš„å¥½å¤„æ˜¯ä¾¿æºï¼Œä½†æ²¡æœ‰æš‚åœé”®ï¼Œåªæœ‰é‡å¤æ’­æ”¾ã€‚ä¸‹é¢ç”¨ **echarts4r** åŒ…åˆ¶ä½œé¢å‘ç½‘é¡µå±•ç¤ºçš„åŠ¨æ€æ°”æ³¡å›¾ï¼Œéšæ—¶æš‚åœå’Œæ’­æ”¾ï¼Œè¿˜å¯å›çœ‹ï¼Œç‚¹å‡»å…·ä½“çš„æ°”æ³¡è¿˜å¯æŸ¥çœ‹æ•°æ®ç»†èŠ‚ã€‚äº¤äº’å¼åŠ¨æ€å›¾çš„å¥½å¤„å°±æ˜¯å¤šï¼Œä¸è¿‡ï¼Œåˆ¶ä½œèµ·æ¥ä¹Ÿéº»çƒ¦ä¸€äº›ã€‚ä¸€äº›å¸¸ç”¨çš„æŠ€æœ¯ç»†èŠ‚åœ¨å¦ä¸€ç¯‡æ–‡ç« [ã€ŠR è¯­è¨€åˆ¶ä½œåœ°åŒºåˆ†å¸ƒå›¾åŠå…¶åŠ¨ç”»ã€‹](/2022/05/choropleth-map-animation/)åˆ¶ä½œWeb åŠ¨ç”»éƒ¨åˆ†ä»‹ç»è¿‡äº†ã€‚ä¸‹é¢æ¡å‡ ä¸ªé‡ç‚¹ä»‹ç»ï¼Œå…¶ä¸€æ·»åŠ åŠ¨ç”»æ ‡é¢˜å’Œæ°´å°èƒŒæ™¯ï¼Œè¿™å¯ä»¥è®©è¯»è€…æ›´åŠ é†’ç›®åœ°çœ‹åˆ°å½“å‰çŠ¶æ€ï¼Œç”¨ `e_timeline_serie()` é…ç½®ä¸€äº›æ—¶é—´çº¿ç»„ä»¶çš„å‚æ•°ï¼Œå‚æ•°æ˜¯ä¸€ä¸ªåµŒå¥—çš„åˆ—è¡¨ç»“æ„ï¼Œéå¸¸é€‚åˆç”¨ Base R è‡ªå¸¦çš„å‡½æ•° `lapply()` æ¥å®ç°ã€‚

```{r}
library(echarts4r)
# å»æ‰ä¸å®Œæ•´çš„æ•°æ®é›†
wb_hans <- wb_hans[complete.cases(wb_hans), ]
# å‡†å¤‡åŠ¨ç”»æ ‡é¢˜
titles <- lapply(unique(wb_hans$date), FUN = function(x) {
  list(
    text = paste(x, "å¹´å¯¿å‘½ä¸äººå‡GDPå…³ç³»", sep = ""),
    left = "center"
  )
})
# å‡†å¤‡åŠ¨ç”»èƒŒæ™¯æ–‡å­—
years <- lapply(unique(wb_hans$date), FUN = function(x) {
  list(
    subtext = x,
    left = "center",
    top = "center",
    z = 0,
    subtextStyle = list(
      fontSize = 100,
      color = "rgb(170, 170, 170, 0.5)",
      fontWeight = "bolder"
    )
  )
})
```

å…¶äºŒç”¨é¢œè‰²å¡«å……å„ä¸ªæ°”æ³¡ï¼Œåœ¨ wb_hans æ•°æ®é›†ä¸Šæ·»åŠ ä¸€åˆ— colorï¼Œæ ¹æ®å›½å®¶æ‰€åœ¨çš„åŒºåŸŸåˆ†é…ä¸åŒçš„é¢œè‰²ï¼Œé¢œè‰²å–è‡ª **RColorBrewer** åŒ…å†…ç½®çš„ Spectral è°ƒè‰²æ¿ã€‚å„åŒºåŸŸå’Œé¢œè‰²çš„å¯¹åº”å…³ç³»å¯è‡ªå®šä¹‰ï¼Œè°ƒæ•´ `levels` æˆ– `labels` é‡Œé¢çš„é¡ºåºå³å¯ï¼Œè¯»è€…ä¹Ÿå¯è°ƒç”¨å…¶å®ƒè°ƒè‰²æ¿ã€‚

```{r}
wb_hans <- within(wb_hans, {
  color <- factor(
    region,
    levels = c(
      "East Asia & Pacific", "Europe & Central Asia",
      "Latin America & Caribbean", "Middle East & North Africa",
      "North America", "South Asia", "Sub-Saharan Africa"
    ),
    labels = RColorBrewer::brewer.pal(n = 7, name = "Spectral")
  )
})
```

å‡†å¤‡å·¥ä½œå°±ç»ªåï¼Œç»˜åˆ¶åŠ¨ç”»ï¼Œæ•ˆæœå¦‚å›¾\@ref(fig:respect-gapminder)ã€‚

<details>
<p><summary> ç‚¹å‡»æ˜¾ç¤ºæˆ–éšè—ä»£ç  </summary></p>
```{r}
#| ref.label: respect-gapminder
#| eval: false
#| echo: true
```
</details>


```{r}
#| label: respect-gapminder
#| fig.cap: "è‡´æ•¬ Gapminder"
#| echo: false

wb_hans |>
  group_by(date) |>
  # æ¨ªè½´æ˜¯äººå‡ GDP
  e_charts(x = NY.GDP.PCAP.CD, timeline = TRUE) |>
  e_scatter(
    # çºµè½´æ˜¯äººå‡å¯¿å‘½ï¼ˆé¢„æœŸå¯¿å‘½ï¼‰
    serie = SP.DYN.LE00.IN,
    # æ°”æ³¡å¤§å°è¡¨ç¤ºäººå£æ€»æ•°
    size = SP.POP.TOTL,
    # å›½å®¶åç§°
    bind = country,
    # æ°”æ³¡çš„æ ·å¼
    symbol = "circle",
    # æ°”æ³¡å¤§å°çš„ base å‚ç…§å€¼
    symbol_size = 5,
    # è®¾ç½®æ°”æ³¡çš„é€æ˜åº¦ï¼Œç¼“è§£é‡å ç°è±¡
    itemStyle = list(opacity = 0.8),
    # å»æ‰å›¾ä¾‹æ ‡é¢˜ï¼Œä¸ºä¸»æ ‡é¢˜è…¾ä½ç½®
    name = ""
  ) |>
  # å¡«å……æ°”æ³¡é¢œè‰²
  e_add_nested("itemStyle", color) |>
  e_y_axis(
    min = 20, max = 90,
    # çºµè½´æ ‡é¢˜åˆ°è½´çº¿çš„è·ç¦»
    nameGap = 40,
    # çºµè½´æ ‡é¢˜
    name = "äººå‡å¯¿å‘½",
    # çºµè½´æ ‡é¢˜ä½ç½®
    nameLocation = "center",
    # çºµè½´æ ‡é¢˜æ ·å¼
    nameTextStyle = list(fontWeight = "bold", fontSize = 18)
  ) |>
  e_x_axis(
    # è®¾ç½®æ¨ªè½´ä¸ºå¯¹æ•°å°ºåº¦ï¼Œé»˜è®¤ä»¥10ä¸ºåº•
    type = "log",
    min = 10, max = 100000,
    # ä»¥ 10 ä¸ºåº•çš„å¯¹æ•°
    logBase = 10,
    minorSplitLine = list(show = TRUE),
    minorTick = list(show = TRUE, splitNumber = 10),
    nameGap = 30, name = "äººå‡ GDP",
    nameLocation = "center",
    nameTextStyle = list(fontWeight = "bold", fontSize = 18)
  ) |>
  e_tooltip(
    # å®šåˆ¶æ‚¬æµ®å†…å®¹
    # params.name å–è‡ª bind å˜é‡
    formatter = htmlwidgets::JS("
      function(params) {
        if(params.value[0]) {
          return('å›½å®¶: <strong>' + params.name + '</strong>' +
                 '<br />äººå‡ GDP: ' + Math.round(params.value[0]) + 'ç¾å…ƒ' +
                 '<br />äººå‡å¯¿å‘½: ' + Math.round(params.value[1]) + 'å²' +
                 '<br />äººå£æ€»æ•°: ' + Math.round(params.value[2] / 1000000 * 100) / 100 + 'ç™¾ä¸‡')
        } else {
          return('');
        }
        return('');
      }
    ")
  ) |>
  # åˆ»åº¦å•ä½
  e_format_x_axis(suffix = "ç¾å…ƒ") |>
  e_format_y_axis(suffix = "å²") |>
  # åŠ¨ç”»çš„ä¸»æ ‡é¢˜
  e_timeline_serie(title = titles, index = 1) |>
  # åŠ¨ç”»çš„èƒŒæ™¯å¹´ä»½
  e_timeline_serie(title = years, index = 2) |>
  # åŠ¨ç”»è®¾ç½®
  e_timeline_opts(
    autoPlay = FALSE, # è‡ªåŠ¨æ’­æ”¾åŠ¨ç”»
    playInterval = 500, # æ’­æ”¾çš„é€Ÿåº¦ï¼Œå•ä½æ¯«ç§’
    loop = TRUE, # æ˜¯å¦å¾ªç¯æ’­æ”¾åŠ¨ç”»
    show = TRUE
  ) |>
  # åæ ‡ç³»å†…ç½‘æ ¼è·ç¦»å®¹å™¨ä¸‹æ–¹çš„è·ç¦»
  e_grid(bottom = 100)
```

æœ€åï¼Œè¡¥å……å‡ ä¸ªç»†èŠ‚ç‚¹ï¼š

1.  å¿«é€Ÿåˆ¶ä½œä¸€ä¸ªå¸¦æ—¶é—´è½´çš„æ°”æ³¡å›¾\@ref(fig:wb-hans-timeline)æ˜¯ä¸éš¾çš„ï¼Œè¿™å°±ç›¸å½“äºå›¾å½¢ä¸»ä½“å†…å®¹éƒ½æœ‰äº†ã€‚

    <details><summary> ç‚¹å‡»æ˜¾ç¤ºæˆ–éšè—ä»£ç  </summary>
    ```{r}
    #| ref.label: wb-hans-timeline
    #| eval: false
    #| echo: true
    ```
    </details>
    
    ```{r}
    #| label: wb-hans-timeline
    #| fig.cap: "é¢„æœŸå¯¿å‘½ä¸äººå‡ GDP çš„å…³ç³»å˜åŒ–"
    #| echo: false
    
    wb_hans |>
      group_by(date) |>
      # æ¨ªè½´æ˜¯äººå‡ GDP
      e_charts(x = NY.GDP.PCAP.CD, timeline = TRUE) |>
      e_scatter(
        # çºµè½´æ˜¯äººå‡å¯¿å‘½ï¼ˆé¢„æœŸå¯¿å‘½ï¼‰
        serie = SP.DYN.LE00.IN,
        # æ°”æ³¡å¤§å°è¡¨ç¤ºäººå£æ€»æ•°
        size = SP.POP.TOTL,
        # å›½å®¶åç§°
        bind = country,
        # æ°”æ³¡çš„æ ·å¼
        symbol = "circle",
        # æ°”æ³¡å¤§å°çš„ base å‚ç…§å€¼
        symbol_size = 5,
        # è®¾ç½®æ°”æ³¡çš„é€æ˜åº¦ï¼Œç¼“è§£é‡å ç°è±¡
        itemStyle = list(opacity = 0.8),
        # ç”¨äºtooltipçš„æ˜¾ç¤ºï¼Œlegend çš„å›¾ä¾‹ç­›é€‰
        name = "Gapminder"
      ) |>
      e_x_axis(
        # è®¾ç½®æ¨ªè½´ä¸ºå¯¹æ•°å°ºåº¦ï¼Œé»˜è®¤ä»¥10ä¸ºåº•
        type = "log",
        min = 10, max = 100000
      ) |>
      e_y_axis(
        min = 20, max = 90
      ) |>
      e_tooltip()
    ```

1.  **echarts4r** åŒ…æä¾›çš„ `group_by()` å‡½æ•°åªæ”¯æŒä¼ å…¥ä¸€ä¸ªå˜é‡ï¼Œç”¨ä½œåŠ¨ç”»çš„æ—¶é—´å¸§å˜é‡ã€‚å¦‚ä¸‹æ–¹å¼ä¼ å…¥å¤šä¸ªå˜é‡ä¹Ÿæ— æ³•å®ç°åˆ†ç»„æ•ˆæœï¼Œä¸Šé¢çš„åŠ¨ç”»\@ref(fig:respect-gapminder)æ˜¯é€šè¿‡æ·»åŠ å‡½æ•° `e_add_nested()` ä¿®æ”¹ [itemStyle](https://echarts.apache.org/zh/option.html#series-scatter.itemStyle) å®ç°çš„ã€‚è¿™å¾—æ„Ÿè°¢[è‹ç®](https://github.com/swsoyee)åœ¨è®ºå›è§£ç­”æˆ‘å…³äº **echarts4r** åŒ…çš„[ä½¿ç”¨é—®é¢˜](https://d.cosx.org/d/422311)ã€‚

    ```{r}
    #| eval: false
    
    wb_hans |>
      group_by(date, region)
    ```

1.  å¯¹ç…§ Apache ECharts [æ—¶é—´çº¿](https://echarts.apache.org/zh/option.html#timeline) ç»„ä»¶çš„å¸®åŠ©æ–‡æ¡£ï¼Œ**echarts4r** æœ‰çš„å‚æ•°åç§°å’Œ Apache ECharts ç•¥å¾®ä¸åŒï¼Œå‡½æ•° `e_timeline_opts()` çš„ `axis_type` å¯¹åº” `axisType`ï¼Œ`e_timeline_serie()` çš„ `index` å¯¹åº” `currentIndex`ã€‚

1.  æ¬¡åˆ»åº¦çº¿è®¾ç½®çš„å‚ç…§[åæ ‡è½´æ–‡æ¡£](https://echarts.apache.org/zh/option.html#xAxis.minorTick)ï¼Œ`splitNumber` å‚æ•°æ§åˆ¶æ¬¡åˆ»åº¦çº¿åˆ†å‰²æ•°ã€‚å›¾ä¸­è®¾ä¸º 10ï¼Œæ¬¡åˆ»åº¦çº¿ç”±ç–åˆ°å¯†ï¼Œè¿™æ˜¯å¯¹æ•°å‡½æ•°å†³å®šçš„ã€‚

    ```{r}
    log(seq(from = 100, to = 1000, by = 100), base = 10)
    ```

1.  åŠ¨ç”»é‡Œï¼Œå¤§æ°”æ³¡è¦†ç›–å°æ°”æ³¡ï¼Œå°½ç®¡è®¾ç½®äº†é€æ˜åº¦ï¼Œå¯ä»¥çœ‹åˆ°å°æ°”æ³¡çš„ä½ç½®ï¼Œä½†æ˜¯é¼ æ ‡æ‚¬æµ®åœ¨å°æ°”æ³¡ä¸Šæ—¶ï¼Œæ— æ³•æ˜¾ç¤ºå°æ°”æ³¡ä¸Šçš„æ‚¬æµ®æ–‡æœ¬ï¼Œè¿™å¾ˆæœ‰å¯èƒ½æ˜¯ Apache ECharts çš„é—®é¢˜ï¼Œå› ä¸ºå®˜æ–¹ç¤ºä¾‹ä¹Ÿæœ‰æ­¤[é—®é¢˜](https://echarts.apache.org/examples/zh/editor.html?c=scatter-life-expectancy-timeline)ã€‚ä¸€ç§å¯èƒ½çš„ç¼“è§£åŠæ³•æ˜¯æŠŠæ•°æ®é›†æŒ‰äººå£æ€»æ•°åˆ‡åˆ†æˆä¸¤å—ï¼Œå…ˆç”»å¤§æ°”æ³¡ï¼Œå†ç”»å°æ°”æ³¡ï¼Œç¬”è€…æ²¡æœ‰å°è¯•ã€‚

1.  é¼ æ ‡è½åœ¨æ—¶é—´è½´ä¸Šï¼Œæ‚¬æµ®æç¤ºåŒ…å«æ•´ä¸ªè‡ªå®šä¹‰ `e_tooltip()` å†…å®¹ï¼Œè¿™æ˜¯æœ‰é—®é¢˜çš„ï¼Œæ„Ÿè°¢ John Coene æä¾›[è§£å†³åŠæ³•](https://github.com/JohnCoene/echarts4r/issues/433)ã€‚

::: sidebar
ç¬”è€…ä¹‹å‰å°è¯•è¿‡å°†äººå‡ GDP / é¢„æœŸå¯¿å‘½æ•°æ®æ˜ å°„åˆ°åœ°å›¾ä¸Šï¼Œåˆ¶ä½œåœ°ç†å¯è§†åŒ–åŠ¨ç”»ï¼Œå¦‚å›¾\@ref(fig:wb-hans-life)æ‰€ç¤ºï¼Œå®ƒè¡¥å……äº†å„ä¸ªå›½å®¶çš„ç©ºé—´ä½ç½®ä¿¡æ¯ï¼Œç›¸æ¯”äºä¹‹å‰çš„åŒºåŸŸå˜é‡æ›´åŠ ç›´è§‚ï¼Œè™½åªèƒ½å±•ç¤ºä¸€ä¸ªæ•°æ®æŒ‡æ ‡ï¼Œå´å¯ä»¥å±•ç¤ºä»»æ„æ—¶é—´ç‚¹çš„ç©ºé—´åˆ†å¸ƒã€‚ç¬”è€…å»ºè®®åœ¨å±•ç¤ºæ•°æ®çš„æ—¶å€™ï¼Œä¸å¦¨åŒæ—¶æä¾›å¤šç§å±•ç¤ºå½¢å¼ï¼Œè¯»è€…å¯ä»»æ„é€‰æ‹©æŒ‡æ ‡ã€å›¾å½¢å»æ¢ç´¢ã€åˆ†æã€‚
:::

<details>
<p><summary> ç‚¹å‡»æ˜¾ç¤ºæˆ–éšè—ä»£ç  </summary></p>
```{r}
#| ref.label: wb-hans-life
#| eval: false
#| echo: true
```
</details>

```{r}
#| label: wb-hans-life
#| fig.cap: "é¢„æœŸå¯¿å‘½"
#| echo: false

wb_hans <- within(wb_hans, {
  life <- round(SP.DYN.LE00.IN, 2)
})

wb_hans |>
  group_by(date) |>
  e_charts(country, timeline = TRUE) |>
  e_map(serie = life, name = "é¢„æœŸå¯¿å‘½") |>
  e_visual_map(
    min = 15, max = 90,
    inRange = list(
      color = RColorBrewer::brewer.pal(n = 11, name = "RdBu")
    )
  ) |>
  e_tooltip() |>
  e_timeline_opts(
    autoPlay = FALSE, # è‡ªåŠ¨æ’­æ”¾
    show = TRUE, # å±•ç¤ºæ—¶é—´è½´
    playInterval = 1000 # è½¬åœºæ—¶é—´
  )
```

<details>
<p><summary> ç‚¹å‡»æ˜¾ç¤ºæˆ–éšè—ä»£ç  </summary></p>
```{r}
#| ref.label: wb-hans-gdp
#| eval: false
#| echo: true
```
</details>

```{r}
#| label: wb-hans-gdp
#| fig.cap: "äººå‡ GDPï¼ˆå•ä½ï¼šç¾å…ƒï¼Œå–10ä¸ºåº•çš„å¯¹æ•°ï¼‰"
#| echo: false

wb_hans <- within(wb_hans, {
  log_gdp <- round(log(NY.GDP.PCAP.CD, base = 10), 2)
})

wb_hans |>
  group_by(date) |>
  e_charts(country, timeline = TRUE) |>
  e_map(serie = log_gdp, name = "äººå‡ GDPï¼ˆå¯¹æ•°ï¼‰") |>
  e_visual_map(
    min = 1, max = 6,
    inRange = list(
      color = RColorBrewer::brewer.pal(n = 11, name = "RdBu")
    )
  ) |>
  e_tooltip() |>
  e_timeline_opts(
    autoPlay = FALSE, # è‡ªåŠ¨æ’­æ”¾
    show = TRUE, # å±•ç¤ºæ—¶é—´è½´
    playInterval = 1000 # è½¬åœºæ—¶é—´
  )
```

::: sidebar
åœ¨ä¸–ç•Œé“¶è¡Œçš„æ•°æ®é›†é‡Œï¼Œä¿„ç½—æ–¯è”é‚¦çš„å›½å®¶åç§°è®°å½•ä¸º Russian Federationï¼Œè€Œåœ¨ **echarts4r** åŒ…å†…ç½®çš„[ä¸–ç•Œåœ°å›¾æ•°æ®é›†](https://github.com/JohnCoene/echarts4r/blob/master/inst/htmlwidgets/lib/echarts-4.8.0/world.js)é‡Œï¼Œä¿„ç½—æ–¯è”é‚¦çš„å›½å®¶åç§° Russiaï¼Œè¦åŠ ä¸Šè¿™ä¸ªå›½å®¶çš„æ•°æ®ï¼Œéœ€è¦åšä¸€ä¸‹æ•°æ®è½¬åŒ–ï¼Œå®é™…ä¸Šï¼Œè¿˜ä¸æ­¢ä¿„ç½—æ–¯ã€‚ä¸€ä¸ªæ¯”è¾ƒå¥½çš„æ–¹å¼æ˜¯ç”¨**å›½å®¶ä»£ç **ï¼ˆå¦‚ [ISO3](https://en.wikipedia.org/wiki/ISO_3166-1_alpha-3)ï¼‰å…³è”ç»æµç¤¾ä¼šæ•°æ®å’Œåœ°å›¾æ•°æ®ã€‚
:::

<details>
<p><summary> ç‚¹å‡»æ˜¾ç¤ºæˆ–éšè—ä»£ç  </summary></p>
```{r}
#| ref.label: wb-hans-gdp2
#| eval: false
#| echo: true
```
</details>

```{r}
#| label: wb-hans-gdp2
#| fig.cap: "äººå‡ GDPï¼ˆå•ä½ï¼šç¾å…ƒï¼Œå–10ä¸ºåº•çš„å¯¹æ•°ï¼‰"
#| echo: false

wb_hans2 <- within(wb_hans, {
  log_gdp <- round(log(NY.GDP.PCAP.CD, base = 10), 2)
  country <- ifelse(country == "Russian Federation", "Russia", country)
  country <- ifelse(country == "Congo, Dem. Rep.", "Dem. Rep. Congo", country)
  country <- ifelse(country == "Central African Republic", "Central African Rep.", country)
  country <- ifelse(country == "Congo, Rep.", "Congo", country)
  country <- ifelse(country == "South Sudan", "S. Sudan", country)
  country <- ifelse(country == "Egypt, Arab Rep.", "Egypt", country)
  country <- ifelse(country == "Iran, Islamic Rep.", "Iran", country)
  country <- ifelse(country == "Yemen, Rep.", "Yemen", country)
  country <- ifelse(country == "Korea, Dem. People's Rep.", "Dem. Rep. Korea", country)
  country <- ifelse(country == "Korea, Rep.", "Korea", country)
})

wb_hans2 |>
  group_by(date) |>
  e_charts(country, timeline = TRUE) |>
  e_map(serie = log_gdp, name = "äººå‡ GDPï¼ˆå¯¹æ•°ï¼‰") |>
  e_visual_map(
    min = 1, max = 6,
    inRange = list(
      color = RColorBrewer::brewer.pal(n = 11, name = "RdBu")
    )
  ) |>
  e_tooltip() |>
  e_timeline_opts(
    autoPlay = FALSE, # è‡ªåŠ¨æ’­æ”¾
    show = TRUE, # å±•ç¤ºæ—¶é—´è½´
    playInterval = 1000 # è½¬åœºæ—¶é—´
  )
```


# æœ¬æ–‡å°ç»“

ä¸–ç•Œä¸Šæ²¡æœ‰ä¸¤ç‰‡ç›¸åŒçš„å¶å­ï¼Œå·®å¼‚æ˜¯å§‹ç»ˆå­˜åœ¨çš„ï¼Œç»Ÿè®¡ä¸Šçš„æ˜¾è‘—æ€§å·®å¼‚æ˜¯éœ€è¦ä»ä¸‡åƒå˜åŒ–ä¸­ç­›é€‰å‡ºæ¥çš„ã€‚ç›¸æ¯”äºç†è§£å˜åŒ–ï¼Œå…³æ³¨å·®å¼‚æ˜¯å®¹æ˜“çš„ã€‚

åœ¨æ•°æ®åˆ†ææ–¹é¢ï¼Œè¿˜æœ‰å¾ˆå¤šæœ‰æ„æ€çš„è¯é¢˜å€¼å¾—æ¢ç´¢åˆ†æï¼š

1.  ä»æ•°æ®ä¸Šçœ‹ï¼Œä¸­å›½æ˜¯å¦æœ‰è¿›å…¥[ã€Œä¸­ç­‰æ”¶å…¥é™·é˜±ã€](https://en.wikipedia.org/wiki/Middle_income_trap)çš„è¿¹è±¡ï¼Ÿ
1.  æœ‰äººè¯´ï¼Œä¸­å›½åœ¨2035å¹´ä»¥åå°†è¿æ¥çš„ä¸æ˜¯äººå£è€é¾„åŒ–ã€Œé«˜å³°ã€è€Œæ˜¯äººå£è€é¾„åŒ–ã€Œé«˜åŸã€ï¼Œè¿™æ˜¯å¦æœ‰æ•°æ®ä¾æ®ï¼Ÿ
1.  æ˜¯ä¸æ˜¯äººå‡ GDP ä¸Šå»äº†ï¼Œäººå£å¢é•¿ç‡å°±ä¼šä¸‹é™ï¼Ÿäººå£é—®é¢˜ç”±ç»æµå› ç´ ä¸»å¯¼è¿˜æ˜¯æ„è¯†å½¢æ€ä¸»å¯¼ï¼Ÿ
1.  æœ‰äººè¯´ GDP çš„é«˜é€Ÿå¢é•¿ä¼šæ©ç›–å¾ˆå¤šç¤¾ä¼šç»æµé—®é¢˜ï¼Œåªæœ‰æ½®æ°´é€€å»æ‰çŸ¥é“æ˜¯è°åœ¨è£¸æ³³ï¼ŒGDP å¢é•¿è¶Šå¿«æ˜¯ä¸æ˜¯å¤±ä¸šç‡è¶Šä½ï¼Ÿ
1.  è¶Šæ˜¯å®è§‚çš„è¶Šæ˜¯å¤æ‚ï¼Œäº‹å…³å±…æ°‘ç”Ÿæ´»çš„é€šè´§è†¨èƒ€ç‡ã€æ¶ˆè´¹ä»·æ ¼æŒ‡æ•°åˆ°åº•å—ä»€ä¹ˆæ³¢åŠ¨ï¼Ÿ


å¤§åŠ¿æ˜¯ç”±å›½å®¶ã€è¡Œä¸šå†³å®šçš„ï¼Œé€‰æ‹©ä¸€ä¸ªè¡Œä¸šæ–¹å‘æ˜¯ä¸ªäººå¯ä»¥åšçš„ï¼Œå¾ˆå¤šäººè¯´é€‰æ‹©æ¯”åŠªåŠ›é‡è¦ï¼Œç«™åœ¨é£å£ä¸ŠçŒªéƒ½èƒ½é£èµ·æ¥ï¼Œäººè¿™ä¸€ç”Ÿèƒ½åšä¸€æ¬¡é£å£ä¸Šçš„çŒªå°±è¶³å¤Ÿäº†ã€‚è¿™ä¹ˆçœ‹ï¼Œè¿™å¥—é€‰æ‹©çš„æ–¹æ³•è®ºéå¸¸ç±»ä¼¼[å•†ä¸šåˆ†ææ¡†æ¶](https://www.youtube.com/watch?v=xnIYIpXKvNM&ab_channel=%E5%B0%8FLin%E8%AF%B4)ï¼ŒåŸºæœ¬é¢ï¼ˆå®è§‚ï¼‰ã€è¡Œä¸šï¼ˆä¸­è§‚ï¼‰ã€ä¼ä¸šï¼ˆå¾®è§‚ï¼‰éƒ½è¦çœ‹ã€‚é‚£ä¹ˆå¤šçš„è¡Œä¸šã€é‚£ä¹ˆå¤šçš„å˜é‡ï¼Œè¿™ä¸ªå˜é‡é€‰æ‹©ä¸€å®šæ˜¯è¶…é«˜ç»´çš„ï¼Œä»…å‡­ä¸€äººä¹‹åŠ›ï¼Œè¿˜æ˜¯**ç€çœ¼å½“ä¸‹ï¼Œäº†è§£è‡ªå·±**ã€‚


åœ¨æŠ€æœ¯å®ç°æ–¹é¢ï¼Œç¨å¾®æ‰©å±•ä¸€ä¸‹ï¼ŒåŠ¨æ€å›¾å½¢åŒ…å«åŠ¨å›¾ã€åŠ¨ç”»ã€å½±è§†ç­‰ä¸€åˆ‡å¯ä»¥è‡ªåŠ¨æ’­æ”¾ä¸€å¸§å¸§ç”»é¢çš„å›¾å½¢å›¾åƒï¼Œè¿™å°±åŒ…å«å„ç§å„æ ·çš„å½¢å¼ï¼Œå¦‚ GIF åŠ¨å›¾ï¼ŒSWF åŠ¨ç”»ï¼ŒMP4 è§†é¢‘ï¼Œä»¥åŠç½‘é¡µæ¸²æŸ“çš„åŠ¨ç”»ï¼Œå½“ç„¶è¿˜æœ‰ä¸‰ç»´åŠ¨ç”»ã€‚é™¤äº†æœ¬æ–‡ä»‹ç»çš„ä¸¤ä¸ªåˆ¶ä½œåŠ¨ç”»çš„ R åŒ…ï¼ŒR ç¤¾åŒºè¿˜æœ‰ä¸€äº› R åŒ…æœ‰åˆ¶ä½œåŠ¨ç”»çš„èƒ½åŠ›ï¼Œå¦‚è¡¨\@ref(tab:animation-pkgs)æ‰€ç¤ºã€‚ç¬”è€…ç²¾åŠ›å’Œæ—¶é—´æœ‰é™ï¼Œæ„Ÿå…´è¶£çš„è¯»è€…ä¸å¦¨è¯•è¯•å…¶å®ƒçš„æŠ€æœ¯å®ç°ã€‚

```{r}
#| label: animation-pkgs
#| echo: false
#| cache: true

# è·å– R åŒ…å…ƒæ•°æ®
Sys.setenv(R_CRAN_WEB = "https://mirrors.tuna.tsinghua.edu.cn/CRAN")
pdb <- tools::CRAN_package_db()
# ç­›é€‰éƒ¨åˆ† R åŒ…çš„å…ƒæ•°æ®
sub_pdb <- subset(
  x = pdb,
  select = c("Package", "Title"),
  subset = Package %in% c(
    "plotly", "gganimate", "echarts4r",
    "animation", "rgl", "magick", "rayrender"
  )
)
# å»æ‰ Title ä¸­çš„æ¢è¡Œç¬¦
sub_pdb <- within(sub_pdb, {
  Title <- gsub("(\\\n)", " ", Title)
})
# å±•ç¤ºè¡¨æ ¼
knitr::kable(sub_pdb,
  row.names = FALSE,
  caption = "åˆ¶ä½œåŠ¨ç”»çš„ R åŒ…",
  col.names = c("R åŒ…", "ç®€ä»‹")
)
```


Python çš„ [plotly](https://github.com/plotly/plotly.py) æ¨¡å—åŠŸèƒ½æ¯” **echarts4r** çš„è¿˜å¤šï¼Œåœ¨ç»Ÿè®¡å’Œæ˜“ç”¨æ€§æ–¹é¢ä¹Ÿå¼ºå¾ˆå¤šï¼Œæ›´å¤šè¯¦æƒ…è§æ–‡ç« [ã€ŠåŠ¨ç”»åˆ¶ä½œä¸ Plotly Pythonã€‹](/2022/02/plotly-python-animations/)ã€‚


![(\#fig:hans-rosling-python) åŸºäº **gapminder** æ•°æ®ç”¨ plotly å¤ç°æ±‰æ–¯Â·ç½—ç³çš„åŠ¨æ€æ°”æ³¡å›¾](img/gapminder-plotly-python.mov){ width=85% }



# ç¯å¢ƒä¿¡æ¯

åœ¨ RStudio IDE å†…ç¼–è¾‘æœ¬æ–‡çš„ R Markdown æºæ–‡ä»¶ï¼Œç”¨ **blogdown** [@blogdown] æ„å»ºç½‘ç«™ï¼Œ[Hugo](https://github.com/gohugoio/hugo) æ¸²æŸ“ knitr ä¹‹åçš„ Markdown æ–‡ä»¶ï¼Œå¾—ç›Šäº **blogdown** å¯¹ R Markdown æ ¼å¼çš„æ”¯æŒï¼Œå›¾ã€è¡¨å’Œå‚è€ƒæ–‡çŒ®çš„äº¤å‰å¼•ç”¨éå¸¸æ–¹ä¾¿ï¼Œçœäº†ä¸å°‘æ–‡å­—ç¼–è¾‘åŠŸå¤«ã€‚æ–‡ä¸­ä½¿ç”¨äº†å¤šä¸ª R åŒ…ï¼Œä¸ºæ–¹ä¾¿å¤ç°æœ¬æ–‡å†…å®¹ï¼Œä¸‹é¢åˆ—å‡ºè¯¦ç»†çš„ç¯å¢ƒä¿¡æ¯ï¼š

```{r}
#| echo: true

xfun::session_info(packages = c(
  "knitr", "rmarkdown", "blogdown",
  "echarts4r", "gganimate", "ggplot2",
  "ggridges", "ragg", "showtext",
  "wbstats", "gapminder", "ggrepel"
), dependencies = FALSE)
```


# å‚è€ƒæ–‡çŒ®
